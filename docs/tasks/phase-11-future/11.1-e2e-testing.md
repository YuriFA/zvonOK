# –ó–∞–¥–∞—á–∞ 11.1: E2E –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Playwright)

> **–°—Ç–∞—Ç—É—Å:** üìã Planned
>
> **–§–∞–π–ª—ã:**
> - `apps/client/e2e/` ‚Äî E2E —Ç–µ—Å—Ç—ã
> - `apps/client/playwright.config.ts` ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Playwright

## –û–±–∑–æ—Ä

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ end-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å Playwright –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

---

## üéØ –¶–µ–ª—å

- Playwright —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –¢–µ—Å—Ç—ã –¥–ª—è auth flow (login, register, logout)
- –¢–µ—Å—Ç—ã –¥–ª—è room flow (join, create, leave)
- –¢–µ—Å—Ç—ã –¥–ª—è WebRTC (–º–µ–¥–∏–∞-–ø–æ—Ç–æ–∫–∏)
- CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üìù –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Playwright

```bash
# –í apps/client/
pnpm add -D @playwright/test
npx playwright install
```

### 2) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**`apps/client/playwright.config.ts`:**

```typescript
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:5173',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
    { name: 'webkit', use: { ...devices['Desktop Safari'] } },
  ],
  webServer: {
    command: 'pnpm dev',
    url: 'http://localhost:5173',
    reuseExistingServer: !process.env.CI,
  },
});
```

### 3) Auth —Ç–µ—Å—Ç—ã

**`apps/client/e2e/auth.spec.ts`:**

```typescript
import { test, expect } from '@playwright/test';

test.describe('Authentication', () => {
  test('register new user', async ({ page }) => {
    await page.goto('/register');

    await page.fill('[name="username"]', 'testuser');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'Password123');
    await page.fill('[name="confirmPassword"]', 'Password123');

    await page.click('button[type="submit"]');

    await expect(page).toHaveURL('/login');
  });

  test('login with valid credentials', async ({ page }) => {
    await page.goto('/login');

    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'Password123');

    await page.click('button[type="submit"]');

    await expect(page).toHaveURL('/');
  });

  test('login with invalid credentials shows error', async ({ page }) => {
    await page.goto('/login');

    await page.fill('[name="email"]', 'wrong@example.com');
    await page.fill('[name="password"]', 'wrongpassword');

    await page.click('button[type="submit"]');

    await expect(page.locator('text=Invalid email or password')).toBeVisible();
  });
});
```

### 4) Room —Ç–µ—Å—Ç—ã

**`apps/client/e2e/room.spec.ts`:**

```typescript
import { test, expect } from '@playwright/test';

test.describe('Room', () => {
  test.beforeEach(async ({ page }) => {
    // Login –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
    await page.goto('/login');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'Password123');
    await page.click('button[type="submit"]');
    await page.waitForURL('/');
  });

  test('join room with code', async ({ page }) => {
    await page.fill('input[placeholder*="room code"]', 'TEST123');
    await page.click('button:has-text("Join Room")');

    await expect(page).toHaveURL('/room/TEST123');
  });

  test('create new room', async ({ page }) => {
    await page.click('button:has-text("Create Room")');

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ—à–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É
    await expect(page).toHaveURL(/\/room\/[a-zA-Z0-9]+/);
  });
});
```

### 5) –°–∫—Ä–∏–ø—Ç—ã

```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:debug": "playwright test --debug",
    "test:e2e:report": "playwright show-report"
  }
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] Playwright —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] `pnpm test:e2e` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] Auth —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Room —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] HTML –æ—Ç—á—ë—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è

---

## üìñ –ü–æ–ª–µ–∑–Ω–æ–µ

### –ú–æ–∫–∏ –¥–ª—è API

```typescript
test('login with mocked API', async ({ page }) => {
  await page.route('**/api/auth/login', async route => {
    await route.fulfill({
      status: 200,
      body: JSON.stringify({ user: { id: '1', email: 'test@example.com' } }),
    });
  });

  // ... test code
});
```

### –ú–µ–¥–∏–∞-–º–æ–∫–∏

```typescript
test('WebRTC with fake media', async ({ page, context }) => {
  // –ú–æ–∫ –∫–∞–º–µ—Ä—ã
  await context.route('**/getUserMedia', async route => {
    await route.fulfill({
      status: 200,
      contentType: 'video/webm',
      body: Buffer.from('fake video'),
    });
  });

  // –ò–ª–∏ –¥–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∞ –±—Ä–∞—É–∑–µ—Ä–∞
  await page.grantPermissions(['camera', 'microphone']);
});
```
