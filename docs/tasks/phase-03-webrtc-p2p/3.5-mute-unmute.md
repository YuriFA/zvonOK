# –ó–∞–¥–∞—á–∞ 3.5: Mute/Unmute –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ

## –û–±–∑–æ—Ä

–ö–æ–Ω—Ç—Ä–æ–ª—å –º–µ–¥–∏–∞-—Ç—Ä–µ–∫–æ–≤ ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–∞ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

## üéØ –¶–µ–ª—å

- –ö–Ω–æ–ø–∫–∞ toggle video –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –∫–∞–º–µ—Ä—É
- –ö–Ω–æ–ø–∫–∞ toggle audio –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å participants

## üìö –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ

[MediaStreamTrack MDN](https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamTrack)

## üìù –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Hook –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∞

```typescript
// apps/client/src/hooks/use-media-controls.ts
import { useState, useRef, useCallback } from 'react';

export function useMediaControls(stream: MediaStream | null) {
  const [isVideoEnabled, setIsVideoEnabled] = useState(true);
  const [isAudioEnabled, setIsAudioEnabled] = useState(true);

  const videoTrackRef = useRef<MediaStreamTrack | null>(null);
  const audioTrackRef = useRef<MediaStreamTrack | null>(null);

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å refs –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ stream
  const updateTrackRefs = useCallback(() => {
    if (stream) {
      videoTrackRef.current = stream.getVideoTracks()[0] || null;
      audioTrackRef.current = stream.getAudioTracks()[0] || null;

      setIsVideoEnabled(videoTrackRef.current?.enabled ?? false);
      setIsAudioEnabled(audioTrackRef.current?.enabled ?? false);
    }
  }, [stream]);

  // Toggle video
  const toggleVideo = useCallback(() => {
    const track = videoTrackRef.current;
    if (track) {
      track.enabled = !track.enabled;
      setIsVideoEnabled(track.enabled);
    }
  }, []);

  // Toggle audio
  const toggleAudio = useCallback(() => {
    const track = audioTrackRef.current;
    if (track) {
      track.enabled = !track.enabled;
      setIsAudioEnabled(track.enabled);
    }
  }, []);

  return {
    isVideoEnabled,
    isAudioEnabled,
    toggleVideo,
    toggleAudio,
    updateTrackRefs,
  };
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```typescript
// apps/client/src/components/media-controls.tsx
import { Mic, MicOff, Video, VideoOff } from 'lucide-react';

interface MediaControlsProps {
  isVideoEnabled: boolean;
  isAudioEnabled: boolean;
  onToggleVideo: () => void;
  onToggleAudio: () => void;
  onLeaveRoom?: () => void;
}

export function MediaControls({
  isVideoEnabled,
  isAudioEnabled,
  onToggleVideo,
  onToggleAudio,
  onLeaveRoom,
}: MediaControlsProps) {
  return (
    <div className="flex items-center justify-center gap-4 p-4 bg-gray-900">
      <button
        onClick={onToggleAudio}
        className={`p-4 rounded-full ${
          isAudioEnabled
            ? 'bg-gray-700 hover:bg-gray-600'
            : 'bg-red-600 hover:bg-red-700'
        } transition-colors`}
        title={isAudioEnabled ? '–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω' : '–í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω'}
      >
        {isAudioEnabled ? (
          <Mic className="w-6 h-6 text-white" />
        ) : (
          <MicOff className="w-6 h-6 text-white" />
        )}
      </button>

      <button
        onClick={onToggleVideo}
        className={`p-4 rounded-full ${
          isVideoEnabled
            ? 'bg-gray-700 hover:bg-gray-600'
            : 'bg-red-600 hover:bg-red-700'
        } transition-colors`}
        title={isVideoEnabled ? '–í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É' : '–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É'}
      >
        {isVideoEnabled ? (
          <Video className="w-6 h-6 text-white" />
        ) : (
          <VideoOff className="w-6 h-6 text-white" />
        )}
      </button>

      {onLeaveRoom && (
        <button
          onClick={onLeaveRoom}
          className="p-4 rounded-full bg-red-600 hover:bg-red-700 transition-colors"
          title="–ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É"
        >
          <PhoneOff className="w-6 h-6 text-white" />
        </button>
      )}
    </div>
  );
}
```

### –ó–∞–º–µ–Ω–∞ —Ç—Ä–µ–∫–∞ (–¥–ª—è stop/start video)

```typescript
// –í–º–µ—Å—Ç–æ enabled = false, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–µ–∫
const stopVideo = () => {
  const track = localStream?.getVideoTracks()[0];
  if (track) {
    track.stop();  // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å capture —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

    // –£–±—Ä–∞—Ç—å –∏–∑ peer connection
    const sender = peerConnection.getSenders().find(s => s.track === track);
    sender?.replaceTrack(null);
  }
};

const startVideo = async () => {
  const newStream = await navigator.mediaDevices.getUserMedia({ video: true });
  const newTrack = newStream.getVideoTracks()[0];

  // –î–æ–±–∞–≤–∏—Ç—å –≤ peer connection
  const sender = peerConnection.getSenders().find(s => s.track?.kind === 'video');
  await sender?.replaceTrack(newTrack);

  setLocalStream(newStream);
};
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º

```typescript
// –ü—Ä–∏ toggle –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
const toggleVideo = () => {
  videoTrack.enabled = !videoTrack.enabled;
  setIsVideoEnabled(videoTrack.enabled);

  socket.emit('media_state_changed', {
    socketId: socket.id,
    videoEnabled: videoTrack.enabled,
    audioEnabled: audioTrack.enabled,
  });
};

// –°–µ—Ä–≤–µ—Ä —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
socket.on('media_state_changed', ({ socketId, videoEnabled, audioEnabled }) => {
  setParticipantStates(prev => ({
    ...prev,
    [socketId]: { videoEnabled, audioEnabled },
  }));
});
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

```typescript
interface RemoteVideoProps {
  stream: MediaStream | null;
  username: string;
  isVideoOff?: boolean;
  isAudioOff?: boolean;
}

export function RemoteVideo({
  stream,
  username,
  isVideoOff,
  isAudioOff,
}: RemoteVideoProps) {
  return (
    <div className="relative">
      {stream && !isVideoOff ? (
        <video srcObject={stream} autoPlay playsInline className="w-full" />
      ) : (
        <div className="aspect-video bg-gray-800 flex items-center justify-center">
          <span className="text-white text-4xl font-bold">
            {username.charAt(0).toUpperCase()}
          </span>
        </div>
      )}

      {/* –ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ */}
      <div className="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
        {username}
      </div>

      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */}
      <div className="absolute top-2 right-2 flex gap-2">
        {isAudioOff && (
          <div className="bg-red-600 p-1 rounded">
            <MicOff className="w-4 h-4 text-white" />
          </div>
        )}
        {isVideoOff && (
          <div className="bg-red-600 p-1 rounded">
            <VideoOff className="w-4 h-4 text-white" />
          </div>
        )}
      </div>
    </div>
  );
}
```

## ‚ö†Ô∏è –ù—é–∞–Ω—Å—ã

### enabled vs stop

| –ú–µ—Ç–æ–¥ | –¢—Ä–µ–∫ | Camera LED | Bandwidth |
|-------|------|------------|-----------|
| `track.enabled = false` | –í –∞–∫—Ç–∏–≤–µ–Ω | ‚úàÔ∏è –í–∫–ª—é—á–µ–Ω | ‚¨áÔ∏è –£–º–µ–Ω—å—à–µ–Ω |
| `track.stop()` | –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | ‚ö´ –í—ã–∫–ª—é—á–µ–Ω | ‚¨áÔ∏è –ù–µ—Ç –ø–æ—Ç–æ–∫–∞ |

**–î–ª—è mute:** –ò—Å–ø–æ–ª—å–∑—É–π `enabled = false`
**–î–ª—è stop –∫–∞–º–µ—Ä—ã:** –ò—Å–ø–æ–ª—å–∑—É–π `track.stop()`

### –ó–∞–º–µ–Ω–∞ —Ç—Ä–µ–∫–∞ –≤ peer connection

```typescript
const sender = pc.getSenders().find(s => s.track?.kind === 'video');
await sender?.replaceTrack(newTrack);
```

**–í–∞–∂–Ω–æ:** `replaceTrack` –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫.

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –ö–Ω–æ–ø–∫–∞ toggle video –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –∫–∞–º–µ—Ä—É
- [ ] –ö–Ω–æ–ø–∫–∞ toggle audio –≤–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–∞" –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–π –∫–∞–º–µ—Ä–µ
- [ ] –ò–∫–æ–Ω–∫–∏ –∫–Ω–æ–ø–æ–∫ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- [ ] –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

## üéÆ –°–ª–µ–¥—É—é—â–∞—è: [–§–∞–∑–∞ 4: –®–µ—Ä–∏–Ω–≥ —ç–∫—Ä–∞–Ω–∞](../phase-04-screen-share/README.md)
