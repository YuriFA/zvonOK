# –ó–∞–¥–∞—á–∞ 10.1: Network Info ‚Äî –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## –û–±–∑–æ—Ä

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ real-time: –±–∏—Ç—Ä–µ–π—Ç, packet loss, jitter, RTT.

## üéØ –¶–µ–ª—å

- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å stats –¥–ª—è –∫–∞–∂–¥–æ–≥–æ peer connection
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ (—Ö–æ—Ä–æ—à–æ/—Å—Ä–µ–¥–Ω–µ/–ø–ª–æ—Ö–æ)
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
1. **[RTCPeerConnection.getStats() MDN](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/getStats)**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

2. **[WebRTC Statistics API](https://www.w3.org/TR/webrtc-stats/)**
   - –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
- **[chrome://webrtc-internals](chrome://webrtc-internals)** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Chrome
- **[WebRTC metrics explained](https://webrtchacks.com/guide-to-webrtc-stats/)** ‚Äî –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

---

## üìù –ë–∞–∑–æ–≤–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### Hook –¥–ª—è stats

```typescript
// apps/client/src/hooks/use-connection-stats.ts
import { useEffect, useState } from 'react';

export interface ConnectionStats {
  bitrate: {
    video: number; // bps
    audio: number; // bps
  };
  packetLoss: number; // %
  jitter: number; // ms
  rtt: number; // ms (round trip time)
  quality: 'good' | 'medium' | 'poor';
}

export function useConnectionStats(peerConnection: RTCPeerConnection | null) {
  const [stats, setStats] = useState<ConnectionStats | null>(null);

  useEffect(() => {
    if (!peerConnection) return;

    const interval = setInterval(async () => {
      const rawStats = await peerConnection.getStats();
      const parsed = parseStats(rawStats);
      setStats(parsed);
    }, 1000); // –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

    return () => clearInterval(interval);
  }, [peerConnection]);

  return stats;
}

function parseStats(rawStats: RTCStatsReport): ConnectionStats {
  let videoBitrate = 0;
  let audioBitrate = 0;
  let packetLoss = 0;
  let jitter = 0;
  let rtt = 0;

  rawStats.forEach(report => {
    // Inbound video
    if (report.type === 'inbound-rtp' && report.kind === 'video') {
      videoBitrate = (report.bytesReceived * 8) / report.timestamp; // bps
      packetLoss = (report.packetsLost / report.packetsReceived) * 100 || 0;
      jitter = report.jitter || 0;
    }

    // Inbound audio
    if (report.type === 'inbound-rtp' && report.kind === 'audio') {
      audioBitrate = (report.bytesReceived * 8) / report.timestamp;
    }

    // RTT (candidate-pair)
    if (report.type === 'candidate-pair' && report.nominated) {
      rtt = report.currentRoundTripTime * 1000 || 0; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ ms
    }
  });

  // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ
  const quality = determineQuality(packetLoss, rtt);

  return {
    bitrate: { video: videoBitrate, audio: audioBitrate },
    packetLoss,
    jitter,
    rtt,
    quality,
  };
}

function determineQuality(
  packetLoss: number,
  rtt: number
): 'good' | 'medium' | 'poor' {
  if (packetLoss > 5 || rtt > 300) {
    return 'poor';
  } else if (packetLoss > 2 || rtt > 150) {
    return 'medium';
  }
  return 'good';
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è (green/yellow/red)
- [ ] –ë–∏—Ç—Ä–µ–π—Ç, packet loss, RTT –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –ø–ª–æ—Ö–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏

---

## üéÆ –°–ª–µ–¥—É—é—â–∞—è: [10.2 Bandwidth Adaptation](./10.2-bandwidth-adaptation.md)
