# –ó–∞–¥–∞—á–∞ 10.3: Reconnection ‚Äî –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ

## –û–±–∑–æ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–µ—Ç–∏ (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ—Ç–µ—Ä—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ WiFi).

## üéØ –¶–µ–ª—å

- –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ–±—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å reconnection –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

1. **[RTCPeerConnection: connectionState MDN](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/connectionState)**
2. **[ICE restart](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/restartIce)**

---

## üìù –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### Hook –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è disconnection

```typescript
// apps/client/src/hooks/use-reconnection.ts
export function useReconnection(peerConnection: RTCPeerConnection | null) {
  const [connectionState, setConnectionState] = useState<RTCPeerConnectionState>('new');
  const [isReconnecting, setIsReconnecting] = useState(false);

  useEffect(() => {
    if (!peerConnection) return;

    const handleConnectionStateChange = () => {
      const state = peerConnection.connectionState;
      setConnectionState(state);

      if (state === 'disconnected' || state === 'failed') {
        handleReconnect();
      } else if (state === 'connected') {
        setIsReconnecting(false);
      }
    };

    peerConnection.addEventListener('connectionstatechange', handleConnectionStateChange);

    return () => {
      peerConnection.removeEventListener('connectionstatechange', handleConnectionStateChange);
    };
  }, [peerConnection]);

  const handleReconnect = async () => {
    if (isReconnecting) return;

    setIsReconnecting(true);
    console.log('Attempting to reconnect...');

    // ICE restart
    peerConnection?.restartIce();

    // Timeout –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    setTimeout(() => {
      if (peerConnection?.connectionState !== 'connected') {
        // –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        recreateConnection();
      }
    }, 5000);
  };

  return { connectionState, isReconnecting };
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –æ–±—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (disconnected/failed)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ICE restart
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "Reconnecting..."
- [ ] –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- [ ] –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞

---

## üéÆ –ì–æ—Ç–æ–≤–æ! –í–µ—Ä–Ω–∏—Å—å –∫ [README](../README.md)
