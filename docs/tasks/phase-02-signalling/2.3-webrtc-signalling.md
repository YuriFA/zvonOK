# –ó–∞–¥–∞—á–∞ 2.3: Signalling –¥–ª—è WebRTC (offer/answer/ice)

## –û–±–∑–æ—Ä

–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ WebRTC —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ Socket.io. Offer, Answer, ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

---

## üéØ –¶–µ–ª—å

- `offer` —Å–æ–±—ã—Ç–∏–µ ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ SDP offer
- `answer` —Å–æ–±—ã—Ç–∏–µ ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ SDP answer
- `ice_candidate` —Å–æ–±—ã—Ç–∏–µ ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- –°–µ—Ä–≤–µ—Ä –ª–∏—à—å –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã, –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏—Ö

---

## üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
1. **[WebRTC Signaling flow (MDN)](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling)**
   - –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –î–∏–∞–≥—Ä–∞–º–º—ã

2. **[SDP (Session Description Protocol)](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Perfect_negotiation)**
   - –§–æ—Ä–º–∞—Ç SDP
   - Offer/Answer

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
- **[ICE Candidates](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/icecandidate_event)**

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ WebrtcGateway

**–í `apps/server/src/webrtc/webrtc.gateway.ts`:**
```typescript
import {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–º–ø–æ—Ä—Ç—ã
  MessageBody,
  ConnectedSocket,
} from '@nestjs/websockets';
import { Logger } from '@nestjs/common';

interface OfferPayload {
  roomId: string;
  offer: RTCSessionDescriptionInit;
  to: string;  // socketId –ø–æ–ª—É—á–∞—Ç–µ–ª—è
  from: string; // socketId –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}

interface AnswerPayload {
  roomId: string;
  answer: RTCSessionDescriptionInit;
  to: string;
}

interface IceCandidatePayload {
  roomId: string;
  candidate: RTCIceCandidateInit;
  to: string;
}

@WebSocketGateway({
  cors: {
    origin: ['http://localhost:5173'],
    credentials: true,
  },
})
export class WebrtcGateway implements OnGatewayConnection, OnGatewayDisconnect {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

  @SubscribeMessage('offer')
  handleOffer(
    @ConnectedSocket() client: Socket,
    @MessageBody() payload: OfferPayload,
  ) {
    const { roomId, offer, to } = payload;

    this.logger.log(
      `Offer –æ—Ç ${client.id} –∫ ${to} –≤ –∫–æ–º–Ω–∞—Ç–µ ${roomId}`,
    );

    // –ü–µ—Ä–µ—Å–ª–∞—Ç—å offer —Ü–µ–ª–µ–≤–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
    this.server.to(to).emit('offer', {
      offer,
      from: client.id,
      roomId,
    });

    return { success: true };
  }

  @SubscribeMessage('answer')
  handleAnswer(
    @ConnectedSocket() client: Socket,
    @MessageBody() payload: AnswerPayload,
  ) {
    const { roomId, answer, to } = payload;

    this.logger.log(
      `Answer –æ—Ç ${client.id} –∫ ${to} –≤ –∫–æ–º–Ω–∞—Ç–µ ${roomId}`,
    );

    // –ü–µ—Ä–µ—Å–ª–∞—Ç—å answer —Ü–µ–ª–µ–≤–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
    this.server.to(to).emit('answer', {
      answer,
      from: client.id,
      roomId,
    });

    return { success: true };
  }

  @SubscribeMessage('ice_candidate')
  handleIceCandidate(
    @ConnectedSocket() client: Socket,
    @MessageBody() payload: IceCandidatePayload,
  ) {
    const { roomId, candidate, to } = payload;

    // –õ–æ–≥–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è debug, ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —á–∞—Å—Ç–æ
    // this.logger.debug(`ICE candidate –æ—Ç ${client.id} –∫ ${to}`);

    // –ü–µ—Ä–µ—Å–ª–∞—Ç—å ICE –∫–∞–Ω–¥–∏–¥–∞—Ç —Ü–µ–ª–µ–≤–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
    this.server.to(to).emit('ice_candidate', {
      candidate,
      from: client.id,
      roomId,
    });

    return { success: true };
  }
}
```

---

## üìñ WebRTC Signalling Flow

```
–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä (Alice)                  –ü–æ–ª—É—á–∞—Ç–µ–ª—å (Bob)
     |                                      |
     | 1. createOffer()                     |
     | 2. setLocalDescription(offer)        |
     |                                      |
     | ------- offer (SDP) ----------------> |
     |                                      | 3. setRemoteDescription(offer)
     |                                      | 4. createAnswer()
     |                                      | 5. setLocalDescription(answer)
     |                                      |
     | <------- answer (SDP) ---------------|
     | 6. setRemoteDescription(answer)      |
     |                                      |
     | ------- ICE candidate --------------> |
     |                                      | 7. addIceCandidate()
     |                                      |
     | <------- ICE candidate --------------|
     | 8. addIceCandidate()                 |
     |                                      |
     | (–ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã)          |
     |                                      |
     | ========= CONNECTED! ================|
```

---

## üîç –ß—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è

### 1. SDP Offer

```typescript
{
  type: 'offer',
  sdp: 'v=0\r\no=- 123456 2 IN IP4 127.0.0.1\r\n...'
}
```

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- IP –∞–¥—Ä–µ—Å–∞ –∏ –ø–æ—Ä—Ç—ã
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–¥–µ–∫–∏ (opus, VP8, H264)
- –ú–µ–¥–∏–∞ —Ç—Ä–µ–∫–∏ (–∞—É–¥–∏–æ, –≤–∏–¥–µ–æ)
- ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã)

---

### 2. SDP Answer

```typescript
{
  type: 'answer',
  sdp: 'v=0\r\no=- 789012 2 IN IP4 127.0.0.1\r\n...'
}
```

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–¥–µ–∫–∏
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- IP –∞–¥—Ä–µ—Å–∞ –∏ –ø–æ—Ä—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è

---

### 3. ICE Candidate

```typescript
{
  candidate: 'candidate:1 1 UDP 2130706431 192.168.1.1 54321 typ host',
  sdpMid: '0',
  sdpMLineIndex: 0,
}
```

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- IP:–ø–æ—Ä—Ç –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (priority)
- –¢–∏–ø (host, srflx, relay)

---

## üéØ Socket.io —Å–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

```typescript
// –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç offer
socket.emit('offer', {
  roomId: 'room-123',
  offer: {
    type: 'offer',
    sdp: '...',
  },
  to: 'socket-id-of-bob',
});
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤

```typescript
// –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç offer
socket.on('offer', async ({ offer, from, roomId }) => {
  // from ‚Äî socketId –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  // offer ‚Äî RTCSessionDescriptionInit

  await peerConnection.setRemoteDescription(offer);

  const answer = await peerConnection.createAnswer();
  await peerConnection.setLocalDescription(answer);

  socket.emit('answer', {
    roomId,
    answer,
    to: from,  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä—É
  });
});
```

---

## ‚ö†Ô∏è –ù—é–∞–Ω—Å—ã –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ù–µ–≤–µ—Ä–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü–ª–æ—Ö–æ:**
```typescript
// –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å answer –±–µ–∑ setRemoteDescription(offer)
const answer = await pc.createAnswer();
await pc.setRemoteDescription(offer);  // –°–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ!
```

**–•–æ—Ä–æ—à–æ:**
```typescript
await pc.setRemoteDescription(offer);
const answer = await pc.createAnswer();
await pc.setLocalDescription(answer);
```

---

### 2. ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–æ setRemoteDescription

**–ü—Ä–æ–±–ª–µ–º–∞:** ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Ä–∞–Ω—å—à–µ SDP

**–†–µ—à–µ–Ω–∏–µ:** –û—á–µ—Ä–µ–¥—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
```typescript
const iceCandidatesQueue: RTCIceCandidateInit[] = [];

socket.on('ice_candidate', async ({ candidate }) => {
  if (pc.remoteDescription) {
    await pc.addIceCandidate(candidate);
  } else {
    iceCandidatesQueue.push(candidate);
  }
});

socket.on('offer', async ({ offer }) => {
  await pc.setRemoteDescription(offer);

  // –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–∫–æ–ø–∏–≤—à–∏–µ—Å—è –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
  for (const candidate of iceCandidatesQueue) {
    await pc.addIceCandidate(candidate);
  }
  iceCandidatesQueue.length = 0;
});
```

---

### 3. Null candidate

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å null –∫–∞–Ω–¥–∏–¥–∞—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:** ICE gathering –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è null –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º
```typescript
pc.onicecandidate = (event) => {
  if (event.candidate) {
    socket.emit('ice_candidate', {
      candidate: event.candidate,
      to: remoteSocketId,
    });
  }
  // event.candidate === null –æ–∑–Ω–∞—á–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–±–æ—Ä–∞
  // –ù–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å!
};
```

---

### 4. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –±—Ä–∞—É–∑–µ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–¥–µ–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** SDP negotiate (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ WebRTC, –Ω–æ –º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å)
```typescript
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–æ–¥–µ–∫
const offer = await pc.createOffer();
const sdp = offer.sdp;

// –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å SDP –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ VP8
const modifiedSdp = sdp.replace(
  /(m=video .* )([0-9]+)( .* VP8)/,
  '$1$2$3\r\na=rtpmap:$2 VP8/90000'
);

offer.sdp = modifiedSdp;
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] `offer` –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è —Ü–µ–ª–µ–≤–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
- [ ] `answer` –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è —Ü–µ–ª–µ–≤–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
- [ ] `ice_candidate` –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è —Ü–µ–ª–µ–≤–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
- [ ] –°–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```typescript
private logSignal(type: string, from: string, to: string, roomId: string) {
  this.logger.log(`[Signal] ${type}: ${from} -> ${to} (room: ${roomId})`);
}

@SubscribeMessage('offer')
handleOffer(client: Socket, payload: OfferPayload) {
  this.logSignal('offer', client.id, payload.to, payload.roomId);
  // ...
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
```typescript
socket.on('offer', ({ offer, from }) => {
  console.log('Received offer:', {
    from,
    type: offer.type,
    sdpLength: offer.sdp.length,
    hasAudio: offer.sdp.includes('m=audio'),
    hasVideo: offer.sdp.includes('m=video'),
  });
});
```

---

## üéÆ –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ **[–§–∞–∑–∞ 3: WebRTC P2P –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ](../phase-03-webrtc-p2p/README.md)**

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```typescript
import { plainToInstance, ClassValidator } from 'class-transformer-validator';

class OfferPayloadDto {
  @IsString()
  @IsNotEmpty()
  roomId: string;

  @IsObject()
  offer: RTCSessionDescriptionInit;

  @IsString()
  @IsNotEmpty()
  to: string;
}

@SubscribeMessage('offer')
async handleOffer(client: Socket, payload: any) {
  const dto = plainToInstance(OfferPayloadDto, payload);
  const errors = await validate(dto);

  if (errors.length > 0) {
    return { success: false, error: 'Invalid payload' };
  }

  // ... –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
}
```

---

### 2. –ó–∞–ø–∏—Å—å signalling –ª–æ–≥–æ–≤

```typescript
// –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
@SubscribeMessage('offer')
handleOffer(client: Socket, payload: OfferPayload) {
  this.signallingLogService.log({
    type: 'offer',
    from: client.id,
    to: payload.to,
    roomId: payload.roomId,
    timestamp: new Date(),
  });

  // ... –æ—Ç–ø—Ä–∞–≤–∏—Ç—å offer
}
```

---

### 3. –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
private connections = new Map<string, { startTime: Date }>();

@SubscribeMessage('connected')
handleConnected(client: Socket, payload: { roomId: string }) {
  const key = `${payload.roomId}:${client.id}`;
  this.connections.set(key, { startTime: new Date() });
}

// –ü–æ–∑–∂–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
getConnectionMetrics() {
  return {
    total: this.connections.size,
    averageDuration: '...',
  };
}
```

---

## üìã –ü–æ–ª–Ω—ã–π –∫–æ–¥ WebrtcGateway

```typescript
import {
  WebSocketGateway,
  WebSocketServer,
  OnGatewayConnection,
  OnGatewayDisconnect,
  SubscribeMessage,
  MessageBody,
  ConnectedSocket,
} from '@nestjs/websockets';
import { Server, Socket } from 'socket.io';
import { Logger } from '@nestjs/common';

interface JoinRoomPayload {
  roomId: string;
  userId: string;
  username: string;
}

interface UserInfo {
  socketId: string;
  userId: string;
  username: string;
}

@WebSocketGateway({
  cors: {
    origin: ['http://localhost:5173'],
    credentials: true,
  },
})
export class WebrtcGateway implements OnGatewayConnection, OnGatewayDisconnect {
  @WebSocketServer()
  server: Server;

  private logger = new Logger(WebrtcGateway.name);
  private roomParticipants = new Map<string, Set<string>>();
  private users = new Map<string, UserInfo>();

  // ... handleConnection, handleDisconnect, join_room, leave_room

  @SubscribeMessage('offer')
  handleOffer(client: Socket, payload: any) {
    this.logger.debug(`Offer: ${client.id} -> ${payload.to}`);
    this.server.to(payload.to).emit('offer', {
      offer: payload.offer,
      from: client.id,
      roomId: payload.roomId,
    });
    return { success: true };
  }

  @SubscribeMessage('answer')
  handleAnswer(client: Socket, payload: any) {
    this.logger.debug(`Answer: ${client.id} -> ${payload.to}`);
    this.server.to(payload.to).emit('answer', {
      answer: payload.answer,
      from: client.id,
      roomId: payload.roomId,
    });
    return { success: true };
  }

  @SubscribeMessage('ice_candidate')
  handleIceCandidate(client: Socket, payload: any) {
    this.server.to(payload.to).emit('ice_candidate', {
      candidate: payload.candidate,
      from: client.id,
      roomId: payload.roomId,
    });
    return { success: true };
  }
}
```
