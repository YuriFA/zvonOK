# –ó–∞–¥–∞—á–∞ 0.5.7: Register –°—Ç—Ä–∞–Ω–∏—Ü–∞

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
>
> **–§–∞–π–ª—ã:**
> - `apps/client/src/routes/register.tsx`
> - `apps/client/src/features/auth/register-form.tsx`

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ñ–æ—Ä–º–æ–π, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–∞—Ä–æ–ª–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.

---

## üéØ –¶–µ–ª—å

- Register —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å Card layout
- RegisterForm —Å confirm password
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–∞—Ä–æ–ª—é
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞ email
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ login –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: RegisterForm –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–í `apps/client/src/features/auth/register-form.tsx`:**

```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { registerSchema, type RegisterFormData } from './register.schema';
import { authApi } from './auth-api';
import { ApiError, ConflictError } from '../../lib/api.errors';
import { Button } from '../../components/ui/button';
import { Input } from '../../components/ui/input';

export function RegisterForm() {
  const navigate = useNavigate();
  const [submitError, setSubmitError] = useState<string | null>(null);

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<RegisterFormData>({
    resolver: zodResolver(registerSchema),
    defaultValues: {
      username: '',
      email: '',
      password: '',
      confirmPassword: '',
    },
  });

  const onSubmit = async (data: RegisterFormData) => {
    setSubmitError(null);

    try {
      // –£–±–∏—Ä–∞–µ–º confirmPassword –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
      const { confirmPassword, ...requestData } = data;

      await authApi.register(requestData);

      // –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ login
      navigate('/login', {
        state: { message: 'Account created! Please sign in.' },
      });
    } catch (error) {
      if (error instanceof ConflictError) {
        setSubmitError('Email or username already exists');
      } else if (error instanceof ApiError) {
        setSubmitError(error.message);
      } else {
        setSubmitError('Network error. Please try again.');
      }
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Username */}
      <div>
        <label htmlFor="username" className="block text-sm font-medium text-gray-700 mb-2">
          Username
        </label>
        <Input
          id="username"
          type="text"
          placeholder="johndoe"
          autoComplete="username"
          error={errors.username?.message}
          {...register('username')}
        />
        <p className="mt-1 text-xs text-gray-500">
          3-20 characters, letters, numbers, underscores only
        </p>
      </div>

      {/* Email */}
      <div>
        <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-2">
          Email address
        </label>
        <Input
          id="email"
          type="email"
          placeholder="you@example.com"
          autoComplete="email"
          error={errors.email?.message}
          {...register('email')}
        />
      </div>

      {/* Password */}
      <div>
        <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-2">
          Password
        </label>
        <Input
          id="password"
          type="password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          autoComplete="new-password"
          error={errors.password?.message}
          {...register('password')}
        />
        <PasswordRequirements />
      </div>

      {/* Confirm Password */}
      <div>
        <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700 mb-2">
          Confirm password
        </label>
        <Input
          id="confirmPassword"
          type="password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          autoComplete="new-password"
          error={errors.confirmPassword?.message}
          {...register('confirmPassword')}
        />
      </div>

      {/* Submit error */}
      {submitError && (
        <div className="p-4 bg-danger-50 border border-danger-200 rounded-md">
          <p className="text-sm text-danger-600">{submitError}</p>
        </div>
      )}

      {/* Submit button */}
      <Button
        type="submit"
        disabled={isSubmitting}
        className="w-full"
        size="lg"
      >
        {isSubmitting ? 'Creating account...' : 'Create account'}
      </Button>
    </form>
  );
}

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–∞—Ä–æ–ª—é
function PasswordRequirements() {
  const requirements = [
    { text: 'At least 6 characters', test: (p: string) => p.length >= 6 },
    { text: 'At most 16 characters', test: (p: string) => p.length <= 16 },
    { text: 'One uppercase letter', test: (p: string) => /[A-Z]/.test(p) },
    { text: 'One lowercase letter', test: (p: string) => /[a-z]/.test(p) },
    { text: 'One number', test: (p: string) => /[0-9]/.test(p) },
    { text: 'No spaces', test: (p: string) => /^\S*$/.test(p) },
  ];

  return (
    <ul className="mt-2 text-xs text-gray-500 space-y-1">
      {requirements.map((req, i) => (
        <li key={i} className="flex items-center gap-1">
          <span className="text-gray-400">‚Ä¢</span>
          {req.text}
        </li>
      ))}
    </ul>
  );
}
```

---

### –®–∞–≥ 2: Register —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–í `apps/client/src/routes/register.tsx`:**

```typescript
import { Link, useLocation } from 'react-router';
import { useEffect } from 'react';
import { AuthHeader } from '../features/auth/auth-header';
import { RegisterForm } from '../features/auth/register-form';
import { Card, CardContent, CardFooter } from '../components/ui/card';

export default function RegisterPage() {
  const location = useLocation();
  const message = location.state?.message as string | undefined;

  // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ state (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
  useEffect(() => {
    if (message) {
      // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å toast notification
      console.log(message);
    }
  }, [message]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 px-4">
      <div className="w-full max-w-md">
        <AuthHeader
          title="Create an account"
          subtitle="Sign up to get started"
        />

        <Card>
          <CardContent className="pt-6">
            {/* Success message */}
            {message && (
              <div className="mb-4 p-3 bg-success-50 border border-success-200 rounded-md">
                <p className="text-sm text-success-700">{message}</p>
              </div>
            )}

            <RegisterForm />
          </CardContent>

          <CardFooter className="flex flex-col space-y-4">
            <div className="text-center text-sm text-gray-600">
              Already have an account?{' '}
              <Link
                to="/login"
                className="font-medium text-primary-600 hover:text-primary-700"
              >
                Sign in
              </Link>
            </div>
          </CardFooter>
        </Card>

        {/* Terms of service */}
        <p className="mt-6 text-center text-xs text-gray-500">
          By creating an account, you agree to our{' '}
          <a href="/terms" className="text-primary-600 hover:underline">
            Terms of Service
          </a>{' '}
          and{' '}
          <a href="/privacy" className="text-primary-600 hover:underline">
            Privacy Policy
          </a>
        </p>
      </div>
    </div>
  );
}
```

---

## üìñ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è

```tsx
import { useEffect, useState } from 'react';

function PasswordStrength({ password }: { password: string }) {
  const [strength, setStrength] = useState(0);

  useEffect(() => {
    let score = 0;

    if (password.length >= 6) score++;
    if (password.length >= 10) score++;
    if (/[A-Z]/.test(password)) score++;
    if (/[a-z]/.test(password)) score++;
    if (/[0-9]/.test(password)) score++;
    if (/[^A-Za-z0-9]/.test(password)) score++;

    setStrength(Math.min(score, 4));
  }, [password]);

  const colors = ['bg-gray-200', 'bg-danger-500', 'bg-warning-500', 'bg-success-500', 'bg-success-600'];
  const labels = ['Weak', 'Fair', 'Good', 'Strong'];

  return (
    password.length > 0 && (
      <div className="mt-2">
        <div className="flex gap-1">
          {[0, 1, 2, 3].map((i) => (
            <div
              key={i}
              className={`h-1 flex-1 rounded-full ${
                i < strength ? colors[strength] : colors[0]
              }`}
            />
          ))}
        </div>
        <p className="mt-1 text-xs text-gray-500">
          Password strength: {labels[strength - 1] || 'Very weak'}
        </p>
      </div>
    )
  );
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
<Input
  id="password"
  type="password"
  {...register('password')}
  onChange={(e) => setPassword(e.target.value)}
/>
<PasswordStrength password={password} />
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] Register —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
- [x] RegisterForm —Å 4 –ø–æ–ª—è–º–∏
- [x] Password confirmation —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –í—Å–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ ConfliceError (–¥—É–±–ª–∏–∫–∞—Ç email)
- [x] –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ login –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
- [x] –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞

---

## üéÆ –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ **[–ó–∞–¥–∞—á–∞ 0.5.8: Auth Context](./0.5.8-auth-context.md)**

---

## üí° –ü–æ–ª–µ–∑–Ω–æ–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ username –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```tsx
const [checkingUsername, setCheckingUsername] = useState(false);
const [usernameAvailable, setUsernameAvailable] = useState<boolean | null>(null);

const checkUsername = async (username: string) => {
  if (username.length < 3) return;

  setCheckingUsername(true);
  try {
    await api.get(`/auth/check-username?username=${username}`);
    setUsernameAvailable(true);
  } catch {
    setUsernameAvailable(false);
  } finally {
    setCheckingUsername(false);
  }
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å debounce
<input
  {...register('username', {
    onChange: (e) => {
      debounce(() => checkUsername(e.target.value), 500);
    }
  })}
/>
```

### Email verification

```tsx
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
navigate('/verify-email', {
  state: {
    email: data.email,
    message: 'Please check your email to verify your account.',
  },
});
```
