# –ó–∞–¥–∞—á–∞ 0.5.4: Forms + Validation (React Hook Form + Zod)

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
>
> **–§–∞–π–ª—ã:**
> - `apps/client/src/features/auth/login.schema.ts`
> - `apps/client/src/features/auth/register.schema.ts`
> - `apps/client/src/features/auth/login-form.tsx`
> - `apps/client/src/features/auth/register-form.tsx`

## –û–±–∑–æ—Ä

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ React Hook Form –∏ Zod –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–≤–æ–¥–∞.

---

## üéØ –¶–µ–ª—å

- React Hook Form –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞–º–∏
- Zod —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Zod —Å React Hook Form
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –í apps/client/
pnpm add react-hook-form @hookform/resolvers zod
```

**–ü–∞–∫–µ—Ç—ã:**
- `react-hook-form` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞–º–∏
- `@hookform/resolvers` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏
- `zod` ‚Äî TypeScript-first –≤–∞–ª–∏–¥–∞—Ü–∏—è

---

### –®–∞–≥ 2: Zod —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### Login —Å—Ö–µ–º–∞

**–í `apps/client/src/features/auth/login.schema.ts`:**

```typescript
import { z } from 'zod';

export const loginSchema = z.object({
  email: z
    .string()
    .min(1, 'Email is required')
    .email('Invalid email address'),
  password: z
    .string()
    .min(1, 'Password is required')
    .min(6, 'Password must be at least 6 characters'),
});

export type LoginFormData = z.infer<typeof loginSchema>;
```

#### Register —Å—Ö–µ–º–∞

**–í `apps/client/src/features/auth/register.schema.ts`:**

```typescript
import { z } from 'zod';

export const registerSchema = z.object({
  username: z
    .string()
    .min(1, 'Username is required')
    .min(3, 'Username must be at least 3 characters')
    .max(20, 'Username must not exceed 20 characters')
    .regex(
      /^[a-zA-Z0-9_]+$/,
      'Username can only contain letters, numbers, and underscores'
    ),
  email: z
    .string()
    .min(1, 'Email is required')
    .email('Invalid email address'),
  password: z
    .string()
    .min(1, 'Password is required')
    .min(6, 'Password must be at least 6 characters')
    .max(16, 'Password must not exceed 16 characters')
    .regex(/[A-Z]/, 'Password must contain at least one uppercase letter')
    .regex(/[a-z]/, 'Password must contain at least one lowercase letter')
    .regex(/[0-9]/, 'Password must contain at least one number')
    .regex(
      /^[^\s]*$/,
      'Password must not contain spaces'
    ),
  confirmPassword: z
    .string()
    .min(1, 'Please confirm your password'),
}).refine(
  (data) => data.password === data.confirmPassword,
  {
    message: 'Passwords do not match',
    path: ['confirmPassword'],
  }
);

export type RegisterFormData = z.infer<typeof registerSchema>;
```

---

### –®–∞–≥ 3: Login —Ñ–æ—Ä–º–∞

**–í `apps/client/src/features/auth/login-form.tsx`:**

```typescript
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Link } from 'react-router';
import { loginSchema, type LoginFormData } from './login.schema';
import { Button } from '../../components/ui/button';
import { Input } from '../../components/ui/input';

export function LoginForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    setError,
  } = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
  });

  const onSubmit = async (data: LoginFormData) => {
    try {
      // API call –¥–ª—è –ª–æ–≥–∏–Ω–∞
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(data),
      });

      if (!response.ok) {
        const error = await response.json();
        setError('root', { message: error.message || 'Login failed' });
        return;
      }

      // –£—Å–ø–µ—à–Ω—ã–π –ª–æ–≥–∏–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      window.location.href = '/';
    } catch (error) {
      setError('root', { message: 'Network error. Please try again.' });
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      {/* Email */}
      <div>
        <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
          Email
        </label>
        <Input
          id="email"
          type="email"
          placeholder="your@email.com"
          error={errors.email?.message}
          {...register('email')}
        />
      </div>

      {/* Password */}
      <div>
        <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
          Password
        </label>
        <Input
          id="password"
          type="password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          error={errors.password?.message}
          {...register('password')}
        />
      </div>

      {/* Root error */}
      {errors.root && (
        <div className="p-3 bg-danger-50 border border-danger-200 rounded-md">
          <p className="text-sm text-danger-600">{errors.root.message}</p>
        </div>
      )}

      {/* Submit */}
      <Button
        type="submit"
        disabled={isSubmitting}
        className="w-full"
      >
        {isSubmitting ? 'Signing in...' : 'Sign In'}
      </Button>

      {/* Link to register */}
      <p className="text-center text-sm text-gray-600">
        Don't have an account?{' '}
        <Link to="/register" className="text-primary-600 hover:underline">
          Sign up
        </Link>
      </p>
    </form>
  );
}
```

---

### –®–∞–≥ 4: Register —Ñ–æ—Ä–º–∞

**–í `apps/client/src/features/auth/register-form.tsx`:**

```typescript
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Link } from 'react-router';
import { registerSchema, type RegisterFormData } from './register.schema';
import { Button } from '../../components/ui/button';
import { Input } from '../../components/ui/input';

export function RegisterForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    setError,
  } = useForm<RegisterFormData>({
    resolver: zodResolver(registerSchema),
  });

  const onSubmit = async (data: RegisterFormData) => {
    try {
      // API call –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      const { confirmPassword, ...requestData } = data;

      const response = await fetch('/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestData),
      });

      if (!response.ok) {
        const error = await response.json();
        setError('root', { message: error.message || 'Registration failed' });
        return;
      }

      // –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
      window.location.href = '/login';
    } catch (error) {
      setError('root', { message: 'Network error. Please try again.' });
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      {/* Username */}
      <div>
        <label htmlFor="username" className="block text-sm font-medium text-gray-700 mb-1">
          Username
        </label>
        <Input
          id="username"
          type="text"
          placeholder="johndoe"
          error={errors.username?.message}
          {...register('username')}
        />
      </div>

      {/* Email */}
      <div>
        <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
          Email
        </label>
        <Input
          id="email"
          type="email"
          placeholder="your@email.com"
          error={errors.email?.message}
          {...register('email')}
        />
      </div>

      {/* Password */}
      <div>
        <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
          Password
        </label>
        <Input
          id="password"
          type="password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          error={errors.password?.message}
          {...register('password')}
        />
      </div>

      {/* Confirm Password */}
      <div>
        <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700 mb-1">
          Confirm Password
        </label>
        <Input
          id="confirmPassword"
          type="password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          error={errors.confirmPassword?.message}
          {...register('confirmPassword')}
        />
      </div>

      {/* Root error */}
      {errors.root && (
        <div className="p-3 bg-danger-50 border border-danger-200 rounded-md">
          <p className="text-sm text-danger-600">{errors.root.message}</p>
        </div>
      )}

      {/* Submit */}
      <Button
        type="submit"
        disabled={isSubmitting}
        className="w-full"
      >
        {isSubmitting ? 'Creating account...' : 'Sign Up'}
      </Button>

      {/* Link to login */}
      <p className="text-center text-sm text-gray-600">
        Already have an account?{' '}
        <Link to="/login" className="text-primary-600 hover:underline">
          Sign in
        </Link>
      </p>
    </form>
  );
}
```

---

## üìñ Zod API

### –ë–∞–∑–æ–≤—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```typescript
z.string()              // –°—Ç—Ä–æ–∫–∞
z.number()              // –ß–∏—Å–ª–æ
z.boolean()             // –ë—É–ª–µ–≤–æ
z.null()                // Null
z.undefined()           // Undefined
z.literal('value')      // –¢–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

// –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
z.string().optional()   // string | undefined
z.string().nullable()   // string | null
z.string().nullish()    // string | null | undefined
```

### –°—Ç—Ä–æ–∫–æ–≤—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```typescript
z.string()
  .min(5)                    // –ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤
  .max(20)                   // –ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤
  .length(10)                // –†–æ–≤–Ω–æ 10 —Å–∏–º–≤–æ–ª–æ–≤
  .email()                   // Email —Ñ–æ—Ä–º–∞—Ç
  .url()                     // URL —Ñ–æ—Ä–º–∞—Ç
  .uuid()                    // UUID —Ñ–æ—Ä–º–∞—Ç
  .regex(/^[A-Z]/)          // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
  .startsWith('prefix')      // –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å
  .endsWith('suffix')        // –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞
  .trim()                    // –£–±—Ä–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã
```

### Transformations

```typescript
z.string()
  .transform((val) => val.toLowerCase())

z.string()
  .refine((val) => val.length > 0, { message: 'Required' })

// Custom refinement
z.string().refine(
  (val) => /^[A-Z]/.test(val),
  { message: 'Must start with uppercase' }
)
```

---

## üìñ React Hook Form API

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π

```tsx
<input {...register('fieldName')} />
<input {...register('fieldName', { required: true })} />
```

### –û—à–∏–±–∫–∏

```tsx
// –í—Å–µ –æ—à–∏–±–∫–∏
formState: { errors, isValid, isDirty, isSubmitting }

// –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
errors.fieldName?.message

// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—à–∏–±–∫—É
setError('fieldName', { message: 'Custom error' })
setError('root', { message: 'General error' })

// –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏
clearErrors()
clearErrors('fieldName')
```

### Submit

```tsx
handleSubmit((data) => {
  // –£—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
  console.log(data)
})

handleSubmit(onValid, onInvalid)
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] React Hook Form —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [x] Zod —Å—Ö–µ–º—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è login –∏ register
- [x] LoginForm —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] RegisterForm —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [x] Passwords match –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéÆ –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ **[–ó–∞–¥–∞—á–∞ 0.5.5: Auth API Client](./0.5.5-auth-api-client.md)**

---

## üí° –ü–æ–ª–µ–∑–Ω–æ–µ

### –¢–∏–ø—ã –∏–∑ Zod

```typescript
const schema = z.object({
  name: z.string(),
  age: z.number(),
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ —Ç–∏–ø–∞
type SchemaType = z.infer<typeof schema>;
// { name: string; age: number; }
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

```typescript
.refine(
  async (email) => {
    const response = await fetch(`/api/check-email?email=${email}`);
    return response.ok;
  },
  { message: 'Email already exists' }
)
```
