# –ó–∞–¥–∞—á–∞ 0.5.3: React Router v7 (–§–∞–π–ª–æ–≤—ã–π —Ä–æ—É—Ç–∏–Ω–≥)

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
>
> **–§–∞–π–ª—ã:**
> - `apps/client/src/routes/lobby.tsx`
> - `apps/client/src/routes/login.tsx`
> - `apps/client/src/routes/register.tsx`
> - `apps/client/src/routes/room.tsx`
> - `apps/client/src/main.tsx`

## –û–±–∑–æ—Ä

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ React Router v7 —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–æ—É—Ç–∏–Ω–≥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SPA –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

---

## üéØ –¶–µ–ª—å

- React Router v7 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –§–∞–π–ª–æ–≤—ã–π —Ä–æ—É—Ç–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –°—Ç—Ä–∞–Ω–∏—Ü—ã: / (lobby), /login, /register, /room/:room
- Navigation guards –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ React Router v7

```bash
# –í apps/client/
pnpm add react-router
```

**React Router v7 –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –§–∞–π–ª–æ–≤—ã–π —Ä–æ—É—Ç–∏–Ω–≥ (–∫–∞–∫ –≤ Next.js)
- `react-router` –≤–º–µ—Å—Ç–æ `react-router-dom`
- –ù–æ–≤—ã–π data loading API

---

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å main.tsx

**–í `apps/client/src/main.tsx`:**

```typescript
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import {
  createRouter,
  createRoute,
  createRootRoute,
  RouterProvider,
} from 'react-router';
import './index.css';

// Import routes
import LobbyRoute from './routes/lobby';
import LoginRoute from './routes/login';
import RegisterRoute from './routes/register';
import RoomRoute from './routes/room';

// Root route —Å layout
const rootRoute = createRootRoute({
  component: () => (
    <html lang="ru">
      <head>
        <meta charSet="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WebRTC Chat</title>
      </head>
      <body>
        <div id="root"></div>
      </body>
    </html>
  ),
});

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
const routeTree = rootRoute.addChildren([
  createRoute({
    path: '/',
    component: LobbyRoute,
  }),
  createRoute({
    path: '/login',
    component: LoginRoute,
  }),
  createRoute({
    path: '/register',
    component: RegisterRoute,
  }),
  createRoute({
    path: '/room/:room',
    component: RoomRoute,
  }),
]);

// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞
const router = createRouter({
  routeTree,
  defaultPreload: 'intent',
});

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <RouterProvider router={router} />
  </StrictMode>,
);
```

---

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã (routes)

#### Lobby —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–í `apps/client/src/routes/lobby.tsx`:**

```typescript
import { Link } from 'react-router';

export default function LobbyPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="max-w-md w-full">
        <h1 className="text-3xl font-bold text-center mb-8">WebRTC Chat</h1>

        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold mb-4">Join a Room</h2>

          <input
            type="text"
            placeholder="Enter room code"
            className="w-full px-4 py-2 border rounded-md mb-4"
          />

          <button className="w-full bg-primary-600 text-white py-2 rounded-md hover:bg-primary-700">
            Join Room
          </button>

          <div className="mt-6 text-center">
            <p className="text-gray-600">
              Don't have an account?{' '}
              <Link to="/register" className="text-primary-600 hover:underline">
                Sign up
              </Link>
            </p>
            <p className="mt-2 text-gray-600">
              Already have an account?{' '}
              <Link to="/login" className="text-primary-600 hover:underline">
                Sign in
              </Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
```

#### Login —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–í `apps/client/src/routes/login.tsx`:**

```typescript
import { Link } from 'react-router';

export default function LoginPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="max-w-md w-full">
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-2xl font-bold mb-6 text-center">Sign In</h2>

          <form className="space-y-4">
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700">
                Email
              </label>
              <input
                id="email"
                type="email"
                className="mt-1 w-full px-3 py-2 border rounded-md"
              />
            </div>

            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700">
                Password
              </label>
              <input
                id="password"
                type="password"
                className="mt-1 w-full px-3 py-2 border rounded-md"
              />
            </div>

            <button
              type="submit"
              className="w-full bg-primary-600 text-white py-2 rounded-md hover:bg-primary-700"
            >
              Sign In
            </button>
          </form>

          <p className="mt-4 text-center text-gray-600">
            Don't have an account?{' '}
            <Link to="/register" className="text-primary-600 hover:underline">
              Sign up
            </Link>
          </p>
        </div>
      </div>
    </div>
  );
}
```

#### Register —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–í `apps/client/src/routes/register.tsx`:**

```typescript
import { Link } from 'react-router';

export default function RegisterPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="max-w-md w-full">
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-2xl font-bold mb-6 text-center">Sign Up</h2>

          <form className="space-y-4">
            <div>
              <label htmlFor="username" className="block text-sm font-medium text-gray-700">
                Username
              </label>
              <input
                id="username"
                type="text"
                className="mt-1 w-full px-3 py-2 border rounded-md"
              />
            </div>

            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700">
                Email
              </label>
              <input
                id="email"
                type="email"
                className="mt-1 w-full px-3 py-2 border rounded-md"
              />
            </div>

            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700">
                Password
              </label>
              <input
                id="password"
                type="password"
                className="mt-1 w-full px-3 py-2 border rounded-md"
              />
            </div>

            <div>
              <label htmlFor="confirm" className="block text-sm font-medium text-gray-700">
                Confirm Password
              </label>
              <input
                id="confirm"
                type="password"
                className="mt-1 w-full px-3 py-2 border rounded-md"
              />
            </div>

            <button
              type="submit"
              className="w-full bg-primary-600 text-white py-2 rounded-md hover:bg-primary-700"
            >
              Sign Up
            </button>
          </form>

          <p className="mt-4 text-center text-gray-600">
            Already have an account?{' '}
            <Link to="/login" className="text-primary-600 hover:underline">
              Sign in
            </Link>
          </p>
        </div>
      </div>
    </div>
  );
}
```

#### Room —Å—Ç—Ä–∞–Ω–∏—Ü–∞

**–í `apps/client/src/routes/room.tsx`:**

```typescript
import { useParams } from 'react-router';

export default function RoomPage() {
  const { room } = useParams<{ room: string }>();

  return (
    <div className="min-h-screen bg-gray-900">
      <div className="container mx-auto px-4 py-8">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-2xl font-bold text-white">Room: {room}</h1>
          <button className="bg-danger-600 text-white px-4 py-2 rounded-md hover:bg-danger-700">
            Leave
          </button>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {/* Local video */}
          <div className="bg-black rounded-lg aspect-video">
            <video
              autoPlay
              muted
              playsInline
              className="w-full h-full object-cover"
            />
          </div>

          {/* Remote video */}
          <div className="bg-black rounded-lg aspect-video">
            <video
              autoPlay
              playsInline
              className="w-full h-full object-cover"
            />
          </div>
        </div>

        {/* Controls */}
        <div className="flex justify-center gap-4 mt-8">
          <button className="bg-gray-700 text-white p-4 rounded-full hover:bg-gray-600">
            Mic
          </button>
          <button className="bg-gray-700 text-white p-4 rounded-full hover:bg-gray-600">
            Camera
          </button>
        </div>
      </div>
    </div>
  );
}
```

---

## üìñ React Router v7 API

### Link –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```tsx
import { Link } from 'react-router';

<Link to="/login">Login</Link>
<Link to="/room/abc123">Join Room</Link>
<Link to={{ pathname: '/room', search: '?mode=video' }}>
  Join with Video
</Link>
```

### useParams —Ö—É–∫

```tsx
import { useParams } from 'react-router';

function RoomPage() {
  const { room } = useParams<{ room: string }>();
  // room = 'abc123' –¥–ª—è /room/abc123
}
```

### useNavigate —Ö—É–∫

```tsx
import { useNavigate } from 'react-router';

function LoginPage() {
  const navigate = useNavigate();

  const handleLogin = async () => {
    // –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞
    navigate('/');
  };
}
```

---

## üîÑ Navigation Guards

### –ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤ (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

```tsx
// –í routes/room.tsx
import { useEffect } from 'react';
import { useNavigate, useParams } from 'react-router';
import { useAuth } from '../features/auth/auth-context';

export default function RoomPage() {
  const { room } = useParams<{ room: string }>();
  const { user } = useAuth();
  const navigate = useNavigate();

  useEffect(() => {
    if (!user) {
      navigate('/login');
    }
  }, [user, navigate]);

  if (!user) {
    return null; // –∏–ª–∏ loading spinner
  }

  // ... rest of component
}
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] React Router v7 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [x] –§–∞–π–ª–æ–≤—ã–π —Ä–æ—É—Ç–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ main.tsx
- [x] Lobby —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (/) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Login —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (/login) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Register —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (/register) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Room —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (/room/:room) —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéÆ –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ **[–ó–∞–¥–∞—á–∞ 0.5.4: Forms + Validation](./0.5.4-forms-validation.md)**

---

## üí° –ü–æ–ª–µ–∑–Ω–æ–µ

### –ê–∫—Ç–∏–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞

```tsx
import { NavLink } from 'react-router';

<NavLink
  to="/login"
  className={({ isActive }) =>
    isActive ? 'text-primary-600 font-bold' : 'text-gray-600'
  }
>
  Login
</NavLink>
```

### Programmatic navigation

```tsx
import { useNavigate } from 'react-router';

const navigate = useNavigate();

navigate('/login');           // Go to login
navigate(-1);                // Go back
navigate('/room/123', { replace: true }); // Replace history
```
