# –ó–∞–¥–∞—á–∞ 1.5: Rooms API (public rooms + owner‚Äëonly —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)

## –û–±–∑–æ—Ä

REST API –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã.
–í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç JWT (cookie –∏–ª–∏ Bearer). –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ owner.

---

## üéØ –¶–µ–ª—å

- `POST /rooms` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
- `GET /rooms` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç
- `GET /rooms/:slug` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É –ø–æ slug
- `PATCH /rooms/:id` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É (owner only)
- `DELETE /rooms/:id` ‚Äî –∑–∞–≤–µ—Ä—à–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É (owner only, soft delete)

---

## üìù –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1) DTO

**CreateRoomDto**
- `name?: string`
- `maxParticipants?: number` (default 10)

**UpdateRoomDto**
- `name?: string`
- `maxParticipants?: number`
- `status?: 'ended' | 'active'` (owner only)

### 2) –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

**–í—Å–µ endpoints –ø–æ–¥ `JwtAuthGuard`.**

```http
POST   /rooms
GET    /rooms
GET    /rooms/:slug
PATCH  /rooms/:id
DELETE /rooms/:id
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- `POST /rooms` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç slug, owner = —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- `GET /rooms` ‚Äî —Ç–æ–ª—å–∫–æ `isPublic=true` –∏ `status=active`, –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- `GET /rooms/:slug` ‚Äî –ø–æ–∏—Å–∫ –ø–æ slug
- `PATCH /rooms/:id` ‚Äî owner only
- `DELETE /rooms/:id` ‚Äî owner only, –¥–µ–ª–∞–µ—Ç `status=ended`, `endedAt=now`

### 3) –°–µ—Ä–≤–∏—Å

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- owner‚Äëcheck –Ω–∞ update/delete (403)
- —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å slug (–ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∫–æ–ª–ª–∏–∑–∏–∏)

### 4) TTL‚Äë–æ—á–∏—Å—Ç–∫–∞ (1 —á–∞—Å)

–ö–æ–º–Ω–∞—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 1 —á–∞—Å –ø–æ—Å–ª–µ `endedAt`.

**–ü–ª–∞–Ω:**
- –¥–æ–±–∞–≤–∏—Ç—å job, –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª—è–µ—Ç –∫–æ–º–Ω–∞—Ç—ã:
  - `status=ended` –∏ `endedAt < now - 1h`

### 5) –¢–µ—Å—Ç—ã

- create ‚Üí slug —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
- update/delete ‚Üí —Ç–æ–ª—å–∫–æ owner
- list ‚Üí —Ç–æ–ª—å–∫–æ public+active
- cleanup ‚Üí —É–¥–∞–ª—è–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] `POST /rooms` —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–Ω–∞—Ç—É —Å owner
- [ ] `GET /rooms` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- [ ] `GET /rooms/:slug` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ slug
- [ ] `PATCH /rooms/:id` –∏ `DELETE /rooms/:id` –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ owner
- [ ] soft delete –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `status=ended` –∏ `endedAt`
- [ ] TTL‚Äë–æ—á–∏—Å—Ç–∫–∞ —É–¥–∞–ª—è–µ—Ç –∫–æ–º–Ω–∞—Ç—ã —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞

---

## üß™ –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫ (curl)

```bash
curl -X POST http://localhost:3000/rooms \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{"name":"Daily Standup"}'

curl http://localhost:3000/rooms -b cookies.txt
```
